import{_ as U}from"./ZAP2WejQ.js";import{_ as A}from"./ZZtQuO6o.js";import{f as I,l as K,k as R,r as u,x as g,m as b,P as $,o as c,c as i,a as k,F as M,n as j,i as d,b as C,N as z,w as D,q as F,Q as H,K as S,t as O,j as Q,d as W}from"./Bt_NbFr3.js";import{u as q}from"./CBSWu9rs.js";import{r as E,a as L}from"./BPKtRz9c.js";import"./BfOmg0nA.js";import"./DOsE6IPw.js";import"./DzVHD3c6.js";import"./CnZK799a.js";import"./BQkc-AXV.js";import"./Bt7Qu0f8.js";import"./DvDH6DOc.js";const P={class:"leading-relaxed"},ce=I({__name:"[id]",async setup(G){let n,p;const f=K(),_=f.params.id,{data:N,refresh:J}=([n,p]=R(()=>q(`/api/threads/${f.params.id}`,"$Q0enI83uGL")),n=await n,p(),n),a=u(""),x=u();g(()=>{var e;(e=x.value)==null||e.textarea.focus()});const o=u([]),h=b(()=>[m("Hi ðŸ‘‹ I am here to help you learn about whatever you want. Over to you!","system")].concat(N.value??[]).concat(o.value)),r=u(!1),V=b(()=>{const e=h.value[1];if(e&&e.content[0].type==="text")return e.content[0].text.value});async function y(){if(r.value)return;r.value=!0;const e=a.value.trim();o.value.push(m(e,"user")),a.value="",await $fetch("/api/message",{method:"POST",body:{threadId:_,message:e}}),window.ws.send(JSON.stringify({threadId:_,firstMessage:V.value??null})),a.value=""}function m(e,t){const l=Date.now()/1e3;return{id:`msg_${l}`,object:"thread.message",created_at:l,completed_at:null,incomplete_at:null,incomplete_details:null,status:"completed",assistant_id:null,thread_id:"thread_u8Q8ApUiYHscxazWTDMq4xNH",run_id:null,role:t,content:[{type:"text",text:{value:e,annotations:[]}}],attachments:[],metadata:{}}}function v(e){if(e.type==="thread.run.created"){const t=m("","system");o.value.push(t)}else if(e.type==="thread.message.delta"){const t=o.value.at(-1);t.content[0].type==="text"&&(t.content[0].text.value+=e.text)}else e.type==="thread.run.completed"&&(r.value=!1)}g(()=>{E(v)}),$(()=>{L(v)});function T(e){e.key==="Enter"&&!e.shiftKey&&H(y)}return(e,t)=>{const l=U,B=A;return c(),i(M,null,[k("ul",P,[(c(!0),i(M,null,j(d(h),s=>{var w;return c(),i("li",{class:S(["flex w-full my-4",{"justify-end":s.role==="user"}])},[((w=s.content[0])==null?void 0:w.type)==="text"?(c(),i("div",{key:0,class:S(["p-1 rounded px-2 whitespace-pre-wrap",{"bg-gray-200 dark:bg-gray-700":s.role==="user","max-w-[50vw]":s.role==="user"}])},O(s.content[0].text.value),3)):Q("",!0)],2)}),256))]),k("form",{onSubmit:F(y,["prevent"]),class:"flex flex-col items-end"},[C(l,{modelValue:d(a),"onUpdate:modelValue":t[0]||(t[0]=s=>z(a)?a.value=s:null),autoresize:"",placeholder:"Chat...",maxrows:20,onKeydown:T,class:"w-full mb-2",ref_key:"textAreaRef",ref:x},null,8,["modelValue"]),C(B,{type:"submit",disabled:d(r)||!d(a).length},{default:D(()=>[W("Send")]),_:1},8,["disabled"])],32)],64)}}});export{ce as default};
