import{_ as j}from"./DLgGgg-T.js";import{_ as A}from"./B-Lxl_Zs.js";import{f as B,k as D,j as I,r as i,v as $,l as M,y as z,o as d,c as m,a as T,F as S,m as E,h as p,b as C,M as F,w as H,n as K,O as L,J as V,t as q,i as J,d as P}from"./D1rtcPht.js";import{u as Q}from"./cJH77P2W.js";import{e as G}from"./NWjtNAEJ.js";import"./CKc1U0eb.js";import"./NKDqDbzt.js";import"./DPNhhfcq.js";import"./Dk2mhVY2.js";import"./CAZilBRX.js";import"./C4sKyBs4.js";import"./DvDH6DOc.js";const W={class:"leading-relaxed"},de=B({__name:"[id]",async setup(Y){let l,h;const f=D(),N=f.params.id,{data:y,refresh:X}=([l,h]=I(()=>Q(`/api/threads/${f.params.id}`,"$Q0enI83uGL")),l=await l,h(),l),s=i(""),x=i();$(()=>{var e;(e=x.value)==null||e.textarea.focus()});const u=i([]),v=M(()=>{var e;return[_("Hi ðŸ‘‹ I am here to help you learn about whatever you want. Over to you!","system")].concat(((e=y.value)==null?void 0:e.messages)??[]).concat(u.value)}),c=i(!1),w=M(()=>{const e=v.value[1];if(e&&e.content[0].type==="text")return e.content[0].text.value});z(async()=>{var e;w.value&&!((e=y.value)!=null&&e.summary)&&(await $fetch("/api/summary",{method:"POST",body:{message:w.value,threadId:f.params.id}}),G.emit("refresh.threads"))});async function g(){var r;if(c.value)return;c.value=!0;const e=s.value.trim();u.value.push(_(e,"user")),s.value="";const n=_("","system");u.value.push(n);const a=u.value.at(-1),o=await window.fetch("/api/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:N,message:e})}),t=(r=o==null?void 0:o.body)==null?void 0:r.getReader();return new ReadableStream({async start(b){for(;;){const{done:U,value:k}=await t.read();var O=new TextDecoder().decode(k);if(a.content[0].type==="text"&&(a.content[0].text.value+=O),U){c.value=!1;break}b.enqueue(k)}b.close(),t.releaseLock()}})}function _(e,n){const a=Date.now()/1e3;return{id:`msg_${a}`,object:"thread.message",created_at:a,completed_at:null,incomplete_at:null,incomplete_details:null,status:"completed",assistant_id:null,thread_id:"thread_u8Q8ApUiYHscxazWTDMq4xNH",run_id:null,role:n,content:[{type:"text",text:{value:e,annotations:[]}}],attachments:[],metadata:{}}}function R(e){e.key==="Enter"&&!e.shiftKey&&L(g)}return(e,n)=>{const a=j,o=A;return d(),m(S,null,[T("ul",W,[(d(!0),m(S,null,E(p(v),t=>{var r;return d(),m("li",{class:V(["flex w-full my-4",{"justify-end":t.role==="user"}])},[((r=t.content[0])==null?void 0:r.type)==="text"?(d(),m("div",{key:0,class:V(["p-1 rounded px-2 whitespace-pre-wrap",{"bg-gray-200 dark:bg-gray-700":t.role==="user","max-w-[50vw]":t.role==="user"}])},q(t.content[0].text.value),3)):J("",!0)],2)}),256))]),T("form",{onSubmit:K(g,["prevent"]),class:"flex flex-col items-end"},[C(a,{modelValue:p(s),"onUpdate:modelValue":n[0]||(n[0]=t=>F(s)?s.value=t:null),autoresize:"",placeholder:"Chat...",maxrows:20,onKeydown:R,class:"w-full mb-2",ref_key:"textAreaRef",ref:x},null,8,["modelValue"]),C(o,{type:"submit",disabled:p(c)||!p(s).length},{default:H(()=>[P("Send")]),_:1},8,["disabled"])],32)],64)}}});export{de as default};
